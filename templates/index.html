<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            width: 45%;
            margin: 20px;
            float: left;
        }
        @media (max-width: 768px) {
            .chart-container {
                width: 90%;
                float: none;
            }
        }
    </style>
</head>
<body>
    <h1>Dashboard</h1>

     <!-- File upload form -->
    <form method="POST" enctype="multipart/form-data">  
        <input type="file" name="file">
        <input type="submit" value="Upload">
    </form>

    <!-- Display error messages if any -->
    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% endif %}

    <div id="charts-container">  </div>


    {% if charts %}
        {% for chart_data in charts %}

            <div class="chart-container">
                <canvas id="chart{{ loop.index }}"></canvas>
                <script>
                    // Get the charts container div
                    const chartsContainer = document.getElementById('charts-container');

                    // Create a new div for each chart container
                    const chartContainer = document.createElement('div');
                    chartContainer.className = 'chart-container'; // Add the CSS class

                    // Create the canvas element
                    const canvas = document.createElement('canvas');
                    canvas.id = 'chart{{ loop.index }}';

                    // Append the canvas to its container div
                    chartContainer.appendChild(canvas);
                    chartsContainer.appendChild(chartContainer);

                    const ctx{{ loop.index }} = document.getElementById('chart{{ loop.index }}').getContext('2d');
                    const chartData{{ loop.index }} = JSON.parse('{{ chart_data | safe }}');

                    if (chartData{{ loop.index }}.error) {
                        ctx{{ loop.index }}.font = '16px sans-serif'; // Set font for error messages
                        ctx{{ loop.index }}.fillText(chartData{{ loop.index }}.error, 10, 50);
                    } else {
                        new Chart(ctx{{ loop.index }}, {
                            type: 'line',
                            data: chartData{{ loop.index }},
                            options: {}
                        });
                    }

                </script>
            </div>
        {% endfor %}
    {% else %}
        <p>No data available to create charts.</p>
    {% endif %}
</body>
</html>